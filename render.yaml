# render.yaml
# Repo root. Deploy via Render → New → Blueprint (select the patient_profiles branch).

services:
  - type: web
    name: phenomind-backend
    env: python
    plan: free
    rootDir: backend              # Runs build/start inside ./backend
    region: oregon
    autoDeploy: true

    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # Pick ONE startCommand below and keep it on a single line:

    # If app factory exists in backend/app.py: create_app()
    startCommand: gunicorn -w 2 -k gthread -b 0.0.0.0:$PORT "app:create_app()"
    # OR, if you expose `app` in backend/run.py, comment the line above and use:
    # startCommand: gunicorn -w 2 -k gthread -b 0.0.0.0:$PORT run:app

    # If you don't have a /health route, remove this or point to an existing path (e.g., /api/health)
    healthCheckPath: /health

    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: FLASK_ENV
        value: production
      - key: PYTHON_VERSION
        value: 3.11.11
      - key: SECRET_KEY
        generateValue: true
      - key: CORS_ORIGINS
        value: https://phenomind-ui.vercel.app
      - key: DATABASE_URL
        fromDatabase:
          name: phenomind-db
          property: connectionString

databases:
  - name: phenomind-db
    plan: free
    postgresMajorVersion: 15

